# Uniswap V2 DEX å‰ç«¯

åŸºäº React + TypeScript + Vite æ„å»ºçš„ Uniswap V2 å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€å‰ç«¯ç•Œé¢ï¼Œè¿æ¥ Sepolia æµ‹è¯•ç½‘ä¸Šå·²éƒ¨ç½²çš„åˆçº¦ã€‚

---

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ ˆ](#2-æŠ€æœ¯æ ˆ)
3. [é¡¹ç›®ç»“æ„](#3-é¡¹ç›®ç»“æ„)
4. [åŠŸèƒ½è¯´æ˜](#4-åŠŸèƒ½è¯´æ˜)
5. [å¤šè·³ Swap è¯¦è§£](#5-å¤šè·³-swap-è¯¦è§£)
6. [é…ç½®é¡¹](#6-é…ç½®é¡¹)
7. [å¿«é€Ÿå¯åŠ¨](#7-å¿«é€Ÿå¯åŠ¨)
8. [äºŒæ¬¡å¼€å‘](#8-äºŒæ¬¡å¼€å‘)
9. [å¸¸è§é—®é¢˜](#9-å¸¸è§é—®é¢˜)

---

## 1. é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Uniswap V2 DEX å‰ç«¯ï¼Œä¸“é—¨ç”¨äºä¸è‡ªéƒ¨ç½²çš„ Uniswap V2 åˆçº¦äº¤äº’ã€‚

### æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | ç»„ä»¶ | æè¿° |
|------|------|------|
| **Swap å…‘æ¢** | `SwapPermit2.tsx` / `MultiHopSwap.tsx` | æ”¯æŒå¤šè·³è·¯å¾„è‡ªåŠ¨å‘ç°ï¼ˆæœ€å¤š 4 è·³ï¼‰ |
| **æ·»åŠ æµåŠ¨æ€§** | `AddLiquidityPermit2.tsx` / `AddLiquidity.tsx` | åˆ›å»º/æ·»åŠ æµåŠ¨æ€§æ±  |
| **ç§»é™¤æµåŠ¨æ€§** | `RemoveLiquidityPermit2.tsx` / `RemoveLiquidity.tsx` | é”€æ¯ LP Tokenï¼Œèµå›åº•å±‚ä»£å¸ |
| **ä½™é¢æŸ¥è¯¢** | `TokenBalance.tsx` | ä»£å¸ä½™é¢ã€LP æŒä»“ã€æ± å­å‚¨å¤‡ï¼ˆç´§å‡‘åˆ—è¡¨è§†å›¾ï¼‰ |

### è¾…åŠ©åŠŸèƒ½ï¼ˆHeader å¼¹çª—ï¼‰

| åŠŸèƒ½ | å›¾æ ‡ | æè¿° |
|------|------|------|
| **æ°´é¾™å¤´** | ğŸ’§ | ä¸€é”®é¢†å– 5 ç§æµ‹è¯•ä»£å¸ï¼ˆæ¯ç§ 1000 ä¸ªï¼‰ |
| **WETH åŒ…è£…** | ğŸ¦ | ETH â†” WETH è½¬æ¢ |
| **è®¾ç½®** | âš™ï¸ | Permit2/ä¼ ç»Ÿæ¨¡å¼åˆ‡æ¢ |

### å·²é…ç½®çš„åˆçº¦åœ°å€ (Sepolia æµ‹è¯•ç½‘)

| åˆçº¦ | åœ°å€ |
|------|------|
| Factory | `0x9A267db279FE7d11138f9293784460Df577c3198` |
| Router | `0x3c66Fe68778281be4358F21BfB63aE9cD242aB58` |
| Permit2Router | `0x23F77d19fA26514C8053958ca8cD95FF73D22372` |
| Permit2 (å®˜æ–¹) | `0x000000000022D473030F116dDEE9F6B43aC78BA3` |
| Faucet | `0xf641f31d368B61F366672EB88F3a033ACC5DD27d` |
| WETH | `0x7b79995e5f793A07Bc00c21412e50Ecae098E7f9` |

### æµ‹è¯•ä»£å¸

| ä»£å¸ | åœ°å€ |
|------|------|
| TKA | `0x89349c29eAb08674Ccb243aEf113c28847fB5215` |
| TKB | `0x92e90F895172CDc96BB0985BC56f0cA4874aEd79` |
| TKC | `0x7Ca1a37CD0dE6f2bf06c09Da57bEa14344BfBa25` |
| TKD | `0x4dDCabc42aAF3403e300413F3b8AD909F58785b1` |
| TKE | `0xC479b9504E6B70e7cfD8C6479d83D9b5b0883c6` |

---

## 2. æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **React** | 19.x | UI æ¡†æ¶ |
| **TypeScript** | 5.9.x | ç±»å‹å®‰å…¨ |
| **Vite** | 7.x | æ„å»ºå·¥å…· |
| **Wagmi** | 3.x | React Hooks for Ethereum |
| **Viem** | 2.x | ä»¥å¤ªåŠäº¤äº’åº“ |
| **TanStack Query** | 5.x | å¼‚æ­¥çŠ¶æ€ç®¡ç† |

---

## 3. é¡¹ç›®ç»“æ„

```
frontend/
â”œâ”€â”€ public/                       # é™æ€èµ„æº
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ assets/                  # å›¾ç‰‡ç­‰èµ„æº
â”‚   â”œâ”€â”€ components/              # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ConnectWallet.tsx       # é’±åŒ…è¿æ¥ + æ°´é¾™å¤´ + WETH + è®¾ç½®
â”‚   â”‚   â”œâ”€â”€ TokenBalance.tsx        # ä»£å¸ä½™é¢/LP/å‚¨å¤‡ï¼ˆç´§å‡‘åˆ—è¡¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ SwapPermit2.tsx         # å¤šè·³å…‘æ¢ (Permit2)
â”‚   â”‚   â”œâ”€â”€ MultiHopSwap.tsx        # å¤šè·³å…‘æ¢ (ä¼ ç»Ÿæ¨¡å¼)
â”‚   â”‚   â”œâ”€â”€ AddLiquidityPermit2.tsx # æ·»åŠ æµåŠ¨æ€§ (Permit2)
â”‚   â”‚   â”œâ”€â”€ AddLiquidity.tsx        # æ·»åŠ æµåŠ¨æ€§ (ä¼ ç»Ÿ)
â”‚   â”‚   â”œâ”€â”€ RemoveLiquidityPermit2.tsx # ç§»é™¤æµåŠ¨æ€§ (Permit2)
â”‚   â”‚   â””â”€â”€ RemoveLiquidity.tsx     # ç§»é™¤æµåŠ¨æ€§ (ä¼ ç»Ÿ)
â”‚   â”œâ”€â”€ hooks/                   # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â””â”€â”€ usePathFinder.ts        # å¤šè·³è·¯å¾„æŸ¥æ‰¾ï¼ˆæ”¯æŒ 4 è·³ï¼‰
â”‚   â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ contracts.ts            # åˆçº¦åœ°å€å’Œ ABI
â”‚   â”‚   â”œâ”€â”€ tokens.ts               # ä»£å¸é…ç½®ï¼ˆå« WETHï¼‰
â”‚   â”‚   â””â”€â”€ wagmi.ts                # Wagmi é…ç½®
â”‚   â”œâ”€â”€ App.tsx                  # ä¸»åº”ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ App.css                  # åº”ç”¨æ ·å¼
â”‚   â”œâ”€â”€ main.tsx                 # å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ index.css                # å…¨å±€æ ·å¼
â”œâ”€â”€ package.json                 # ä¾èµ–é…ç½®
â”œâ”€â”€ tsconfig.json                # TypeScript é…ç½®
â”œâ”€â”€ vite.config.ts               # Vite é…ç½®
â””â”€â”€ README.md                    # æœ¬æ–‡æ¡£
```

---

## 4. åŠŸèƒ½è¯´æ˜

### 4.1 é’±åŒ…è¿æ¥ (`ConnectWallet.tsx`)

**åŠŸèƒ½**: é’±åŒ…è¿æ¥ + æ°´é¾™å¤´ + WETH åŒ…è£… + è®¾ç½®

**æ ¸å¿ƒ Hooks**:
- `useAccount()` - è·å–å½“å‰è¿æ¥çš„è´¦æˆ·
- `useConnect()` - è¿æ¥é’±åŒ…
- `useDisconnect()` - æ–­å¼€è¿æ¥
- `useBalance()` - è·å– ETH ä½™é¢
- `useReadContract()` - è¯»å– WETH ä½™é¢

**Header å¼¹çª—åŠŸèƒ½**:

| æŒ‰é’® | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| ğŸ’§ | æ°´é¾™å¤´ | ä¸€é”®é¢†å– 5 ç§æµ‹è¯•ä»£å¸ï¼ˆTKA/TKB/TKC/TKD/TKEï¼‰ï¼Œæ¯ç§ 1000 ä¸ª |
| ğŸ¦ | WETH | ETH â†” WETH åŒ…è£…/è§£åŒ…ï¼Œæ”¯æŒ MAX æŒ‰é’® |
| âš™ï¸ | è®¾ç½® | Permit2/ä¼ ç»Ÿæˆæƒæ¨¡å¼åˆ‡æ¢ |

**å¼¹çª—è®¾è®¡**:
- å±…ä¸­æ¨¡æ€æ¡†
- ç‚¹å‡»èƒŒæ™¯å…³é—­
- æ˜¾å¼å…³é—­æŒ‰é’® (âœ•)
- äº’æ–¥æ˜¾ç¤ºï¼ˆåŒæ—¶åªèƒ½æ‰“å¼€ä¸€ä¸ªï¼‰

---

### 4.2 ä»£å¸ä½™é¢ (`TokenBalance.tsx`)

**åŠŸèƒ½**: æ˜¾ç¤ºä»£å¸ä½™é¢ã€LP æŒä»“ã€æ± å­å‚¨å¤‡

**ä¸‰ä¸ªå­é¡µç­¾**:
1. **ä»£å¸ä½™é¢** - æ˜¾ç¤ºæ‰€æœ‰ä»£å¸ä½™é¢
2. **LP ä»£å¸** - æ˜¾ç¤º LP æŒä»“å’Œä»½é¢å æ¯”
3. **æ± å­å‚¨å¤‡** - æ˜¾ç¤ºæ‰€æœ‰æ± å­çš„å‚¨å¤‡é‡å’Œä»·æ ¼

**UI è®¾è®¡**:
- ç´§å‡‘åˆ—è¡¨è§†å›¾ï¼ˆéå¤§å¡ç‰‡ï¼‰
- å›ºå®šé«˜åº¦ 320pxï¼Œè¶…å‡ºæ»šåŠ¨
- è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼
- ä»£å¸å›¾æ ‡ï¼ˆé¦–å­—æ¯ + æ¸å˜èƒŒæ™¯ï¼‰

**æ ¸å¿ƒ Hook**: `useReadContracts()` - æ‰¹é‡è¯»å–å¤šä¸ªåˆçº¦

---

### 4.3 Swap å…‘æ¢ (`SwapPermit2.tsx` / `MultiHopSwap.tsx`)

**åŠŸèƒ½**: å¤šè·³è·¯å¾„è‡ªåŠ¨å‘ç°å’Œå…‘æ¢

**ä¸¤ç§æ¨¡å¼**:
- `SwapPermit2.tsx` - Permit2 æ¨¡å¼ï¼ˆæ¨èï¼Œ1 æ¬¡ç­¾å + 1 æ¬¡äº¤æ˜“ï¼‰
- `MultiHopSwap.tsx` - ä¼ ç»Ÿæ¨¡å¼ï¼ˆéœ€è¦å…ˆæˆæƒï¼‰

**å¤šè·³è·¯å¾„æŸ¥æ‰¾** (`usePathFinder` Hook):
- æœ€å¤§è·³æ•°ï¼š4 è·³ï¼ˆ5 ä¸ªä»£å¸ï¼‰
- è‡ªåŠ¨æšä¸¾æ‰€æœ‰å¯èƒ½è·¯å¾„
- æŒ‰è¾“å‡ºé‡‘é¢é™åºæ’åº
- æ˜¾ç¤ºå¸¦æ ·å¼çš„ä»£å¸æ ‡ç­¾è·¯å¾„

**äº¤äº’æµç¨‹**:
```
1. é€‰æ‹©è¾“å…¥/è¾“å‡ºä»£å¸
2. è¾“å…¥å…‘æ¢æ•°é‡
3. è‡ªåŠ¨æŸ¥æ‰¾æ‰€æœ‰å¯èƒ½è·¯å¾„å¹¶è®¡ç®—è¾“å‡º
4. é€‰æ‹©æœ€ä¼˜è·¯å¾„ï¼ˆæˆ–æ‰‹åŠ¨é€‰æ‹©ï¼‰
5. Permit2 æ¨¡å¼ï¼šç­¾å + äº¤æ˜“ï¼›ä¼ ç»Ÿæ¨¡å¼ï¼šæˆæƒ + äº¤æ˜“
```

**å…³é”®å‚æ•°**:
- `amountIn` - è¾“å…¥æ•°é‡
- `amountOutMin` - æœ€å°è¾“å‡º (æ»‘ç‚¹ä¿æŠ¤)
- `path` - å…‘æ¢è·¯å¾„ï¼ˆå¯å¤šè·³ï¼‰
- `deadline` - äº¤æ˜“æˆªæ­¢æ—¶é—´

**æ»‘ç‚¹è®¾ç½®**: é»˜è®¤ 0.5%

---

### 4.4 æ·»åŠ æµåŠ¨æ€§ (`AddLiquidityPermit2.tsx` / `AddLiquidity.tsx`)

**åŠŸèƒ½**: å‘æ± å­æ·»åŠ ä»£å¸å¯¹ï¼Œè·å¾— LP Token

**ä¸¤ç§æ¨¡å¼**:
- `AddLiquidityPermit2.tsx` - Permit2 æ¨¡å¼ï¼ˆæ¨èï¼Œå•æ¬¡ç­¾åè¦†ç›–ä¸¤ä¸ªä»£å¸ï¼‰
- `AddLiquidity.tsx` - ä¼ ç»Ÿæ¨¡å¼ï¼ˆéœ€è¦åˆ†åˆ«æˆæƒä¸¤ä¸ªä»£å¸ï¼‰

**äº¤äº’æµç¨‹ (Permit2)**:
```
1. è¾“å…¥ Token A å’Œ Token B æ•°é‡
2. é¦–æ¬¡ä½¿ç”¨ï¼šæˆæƒä»£å¸ç»™ Permit2ï¼ˆä¸€æ¬¡æ€§ï¼‰
3. ç­¾åï¼ˆå… gasï¼ŒBatch ç­¾ååŒæ—¶è¦†ç›–ä¸¤ä¸ªä»£å¸ï¼‰
4. å‘é€äº¤æ˜“
5. è·å¾— LP Token
```

**è°ƒç”¨å‡½æ•°**: `Permit2Router.addLiquidityWithPermit2Batch()`

**å‚æ•°è¯´æ˜**:
| å‚æ•° | è¯´æ˜ |
|------|------|
| tokenA, tokenB | ä»£å¸åœ°å€ |
| amountADesired | æœŸæœ›æ·»åŠ çš„ A æ•°é‡ |
| amountBDesired | æœŸæœ›æ·»åŠ çš„ B æ•°é‡ |
| amountAMin | æœ€å°æ¥å—çš„ A æ•°é‡ |
| amountBMin | æœ€å°æ¥å—çš„ B æ•°é‡ |
| to | LP Token æ¥æ”¶åœ°å€ |
| deadline | äº¤æ˜“æˆªæ­¢æ—¶é—´æˆ³ |

---

### 4.5 ç§»é™¤æµåŠ¨æ€§ (`RemoveLiquidityPermit2.tsx` / `RemoveLiquidity.tsx`)

**åŠŸèƒ½**: é”€æ¯ LP Tokenï¼Œèµå›åº•å±‚ä»£å¸

**ä¸¤ç§æ¨¡å¼**:
- `RemoveLiquidityPermit2.tsx` - Permit2 æ¨¡å¼
- `RemoveLiquidity.tsx` - ä¼ ç»Ÿæ¨¡å¼

**äº¤äº’æµç¨‹**:
```
1. è¾“å…¥è¦ç§»é™¤çš„ LP Token æ•°é‡
2. æˆæƒ LP Token ç»™ Router
3. è°ƒç”¨ removeLiquidity
4. æ”¶åˆ° Token A å’Œ Token B
```

**è°ƒç”¨å‡½æ•°**: `Router.removeLiquidity()`

---

## 5. å¤šè·³ Swap è¯¦è§£

### 5.1 ä»€ä¹ˆæ˜¯å¤šè·³ Swapï¼Ÿ

å½“ä¸¤ä¸ªä»£å¸ä¹‹é—´æ²¡æœ‰ç›´æ¥çš„äº¤æ˜“å¯¹æ—¶ï¼Œå¯ä»¥é€šè¿‡ä¸­é—´ä»£å¸è¿›è¡Œå¤šæ¬¡å…‘æ¢ï¼š

```
ç›´æ¥è·¯å¾„:  TKA â†’ TKB (1 è·³)
å¤šè·³è·¯å¾„:  TKA â†’ TKC â†’ TKB (2 è·³)
å¤šè·³è·¯å¾„:  TKA â†’ TKC â†’ TKD â†’ TKB (3 è·³)
```

### 5.2 æœ€ä¼˜è·¯å¾„é€‰æ‹©

**é‡è¦**: æœ€ä¼˜è·¯å¾„é€‰æ‹©æ˜¯åœ¨**å‰ç«¯/é“¾ä¸‹**è®¡ç®—çš„ï¼Œä¸æ˜¯åœ¨åˆçº¦é‡Œå®ç°ã€‚

| å±‚çº§ | èŒè´£ |
|------|------|
| **å‰ç«¯** | æšä¸¾æ‰€æœ‰å¯èƒ½è·¯å¾„ â†’ è°ƒç”¨ `getAmountsOut` â†’ æ¯”è¾ƒè¾“å‡º â†’ é€‰æ‹©æœ€ä¼˜ |
| **åˆçº¦** | åªæ‰§è¡ŒæŒ‡å®šè·¯å¾„çš„ Swap |

### 5.3 æ ¸å¿ƒä»£ç ä½ç½®

| åŠŸèƒ½ | æ–‡ä»¶ | è¡Œå· |
|------|------|------|
| è·¯å¾„ç”Ÿæˆ | `src/hooks/usePathFinder.ts` | `generatePaths()` |
| æ‰¹é‡æŸ¥è¯¢è¾“å‡º | `src/hooks/usePathFinder.ts` | `useReadContracts()` |
| è·¯å¾„æ’åº | `src/hooks/usePathFinder.ts` | `validPaths.sort()` |
| æ„å»ºäº¤æ˜“ | `src/components/MultiHopSwap.tsx` | `handleSwap()` ç¬¬ 61-73 è¡Œ |
| ç­‰å¾…ç¡®è®¤ | `src/components/MultiHopSwap.tsx` | `useWaitForTransactionReceipt()` ç¬¬ 39 è¡Œ |

### 5.4 å®Œæ•´äº¤æ˜“æ—¶åºå›¾

```
ç”¨æˆ·ç‚¹å‡» Swap æŒ‰é’®
      â†“
handleSwap() è°ƒç”¨ writeContract({...})
      â†“
isPending = true (ç­‰å¾…ç”¨æˆ·ç¡®è®¤)
      â†“
MetaMask å¼¹çª—
      â†“
ç”¨æˆ·ç‚¹å‡»ç¡®è®¤
      â†“
MetaMask ç­¾åå¹¶å¹¿æ’­äº¤æ˜“åˆ°åŒºå—é“¾
      â†“
è¿”å› hash = "0x1234..."
      â†“
data (hash) è¢«æ›´æ–°
      â†“
useWaitForTransactionReceipt è‡ªåŠ¨å¼€å§‹ç›‘å¬ hash
      â†“
isConfirming = true (æ¯ 4 ç§’è½®è¯¢ä¸€æ¬¡)
      â†“
åŒºå—é“¾ç¡®è®¤äº¤æ˜“
      â†“
isSuccess = true
      â†“
æ˜¾ç¤º "âœ… äº¤æ˜“æˆåŠŸ!"
```

### 5.5 äº¤æ˜“çŠ¶æ€å˜åŒ–

| é˜¶æ®µ | `hash` | `isPending` | `isConfirming` | `isSuccess` |
|------|--------|-------------|----------------|-------------|
| åˆå§‹ | `undefined` | false | false | false |
| ç”¨æˆ·ç‚¹å‡» Swap | `undefined` | **true** | false | false |
| ç”¨æˆ·ç¡®è®¤å | `"0x1234..."` | false | **true** | false |
| é“¾ä¸Šç¡®è®¤ | `"0x1234..."` | false | false | **true** |

### 5.6 Hash è¿”å›æµç¨‹

```
writeContract() 
    â†“
Wagmi è°ƒç”¨ wallet_sendTransaction
    â†“
MetaMask å¼¹çª—ï¼Œç”¨æˆ·ç¡®è®¤
    â†“
MetaMask ç­¾åå¹¶å¹¿æ’­åˆ°ç½‘ç»œ
    â†“
ç½‘ç»œè¿”å›äº¤æ˜“å“ˆå¸Œ (0x...)
    â†“
MetaMask è¿”å›ç»™ Wagmi
    â†“
useWriteContract çš„ data å­—æ®µæ›´æ–°
    â†“
useWaitForTransactionReceipt è‡ªåŠ¨ç›‘å¬
```

### 5.7 äº¤æ˜“ç›‘å¬æœºåˆ¶

`useWaitForTransactionReceipt` ä½¿ç”¨**è½®è¯¢**æ–¹å¼ç›‘å¬äº¤æ˜“çŠ¶æ€ï¼š

```typescript
const { isSuccess } = useWaitForTransactionReceipt({
  hash,
  confirmations: 1,        // ç­‰å¾…å‡ ä¸ªåŒºå—ç¡®è®¤ï¼Œé»˜è®¤ 1
  pollingInterval: 4000,   // è½®è¯¢é—´éš”ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ 4 ç§’
  timeout: 60_000,         // è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
});
```

**ä¸ºä»€ä¹ˆé»˜è®¤ 4 ç§’ï¼Ÿ**

| ç½‘ç»œ | å‡ºå—æ—¶é—´ | æ¨èè½®è¯¢é—´éš” |
|------|----------|--------------|
| Ethereum/Sepolia | ~12 ç§’ | 4 ç§’ |
| Polygon | ~2 ç§’ | 1 ç§’ |
| Arbitrum | ~0.25 ç§’ | 0.5 ç§’ |

### 5.8 äº¤æ˜“ç¡®è®¤çš„åº•å±‚åŸç†

**æ ¸å¿ƒé—®é¢˜**: å‰ç«¯å¦‚ä½•çŸ¥é“äº¤æ˜“æ‰§è¡ŒæˆåŠŸäº†ï¼Ÿ

**ç­”æ¡ˆ**: é€šè¿‡è½®è¯¢ RPC èŠ‚ç‚¹çš„ `eth_getTransactionReceipt` æ–¹æ³•ã€‚

#### è½®è¯¢æµç¨‹

```
1. å‰ç«¯å‘é€äº¤æ˜“ â†’ è·å¾— hash = "0x1234..."

2. useWaitForTransactionReceipt å¼€å§‹è½®è¯¢ï¼š
   æ¯ 4 ç§’è°ƒç”¨ä¸€æ¬¡: eth_getTransactionReceipt(hash)

3. RPC èŠ‚ç‚¹è¿”å›ç»“æœï¼š
   - äº¤æ˜“è¿˜åœ¨ pending â†’ è¿”å› null â†’ ç»§ç»­è½®è¯¢
   - äº¤æ˜“å·²è¢«æ‰“åŒ… â†’ è¿”å› receipt å¯¹è±¡ â†’ åœæ­¢è½®è¯¢
```

#### Receipt è¿”å›ç»“æ„

```json
{
  "transactionHash": "0x1234...",
  "blockNumber": "0x1234567",
  "status": "0x1",           // â† å…³é”®å­—æ®µï¼1=æˆåŠŸï¼Œ0=å¤±è´¥
  "gasUsed": "0x5208",
  "logs": [...]              // äº‹ä»¶æ—¥å¿—
}
```

#### åˆ¤æ–­æˆåŠŸçš„ä¾æ®

| `status` å€¼ | å«ä¹‰ | `isSuccess` |
|-------------|------|-------------|
| `"0x1"` (1) | äº¤æ˜“æ‰§è¡ŒæˆåŠŸ | `true` |
| `"0x0"` (0) | äº¤æ˜“æ‰§è¡Œå¤±è´¥ï¼ˆrevertï¼‰ | `false` |
| `null` | äº¤æ˜“è¿˜æœªè¢«æ‰“åŒ… | ç»§ç»­è½®è¯¢ |

#### ç®€åŒ–ä»£ç ç¤ºæ„

```typescript
// Wagmi/Viem å†…éƒ¨å®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰
async function waitForReceipt(hash: string) {
  while (true) {
    // è°ƒç”¨ RPC èŠ‚ç‚¹
    const receipt = await rpcClient.request({
      method: 'eth_getTransactionReceipt',
      params: [hash]
    });
    
    if (receipt !== null) {
      // äº¤æ˜“å·²è¢«æ‰“åŒ…åˆ°åŒºå—
      if (receipt.status === '0x1') {
        return { isSuccess: true };  // â† æˆåŠŸ
      } else {
        return { isSuccess: false }; // â† å¤±è´¥ï¼ˆrevertï¼‰
      }
    }
    
    // è¿˜æ²¡æ‰“åŒ…ï¼Œç­‰ 4 ç§’åå†æŸ¥
    await sleep(4000);
  }
}
```

#### å®Œæ•´è½®è¯¢æ—¶åº

```
ç”¨æˆ·ç¡®è®¤äº¤æ˜“
      â†“
MetaMask å¹¿æ’­äº¤æ˜“åˆ°ç½‘ç»œ
      â†“
è¿”å› hash = "0x1234..."
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  useWaitForTransactionReceipt è½®è¯¢å¾ªç¯   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  ç¬¬ 1 æ¬¡: eth_getTransactionReceipt     â”‚
â”‚           â†’ null (è¿˜åœ¨ pending)         â”‚
â”‚           â†’ ç­‰å¾… 4 ç§’                    â”‚
â”‚                                         â”‚
â”‚  ç¬¬ 2 æ¬¡: eth_getTransactionReceipt     â”‚
â”‚           â†’ null (è¿˜åœ¨ pending)         â”‚
â”‚           â†’ ç­‰å¾… 4 ç§’                    â”‚
â”‚                                         â”‚
â”‚  ç¬¬ 3 æ¬¡: eth_getTransactionReceipt     â”‚
â”‚           â†’ { status: "0x1", ... }      â”‚
â”‚           â†’ äº¤æ˜“æˆåŠŸï¼åœæ­¢è½®è¯¢           â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
isSuccess = true
      â†“
UI æ˜¾ç¤º "âœ… äº¤æ˜“æˆåŠŸ!"
```

#### å…³é”®ç‚¹æ€»ç»“

1. **ä¸æ˜¯å®æ—¶æ¨é€**: æ˜¯å‰ç«¯ä¸»åŠ¨å»é—® RPC èŠ‚ç‚¹
2. **åˆ¤æ–­ä¾æ®**: `receipt.status === "0x1"` è¡¨ç¤ºæˆåŠŸ
3. **åŒºå—ç¡®è®¤**: äº¤æ˜“è¢«æ‰“åŒ…è¿›åŒºå— = è¢«çŸ¿å·¥/éªŒè¯è€…æ‰§è¡Œå¹¶è®°å½•
4. **å¤±è´¥æƒ…å†µ**: å¦‚æœåˆçº¦ `require()` å¤±è´¥ï¼Œ`status` ä¼šæ˜¯ `"0x0"`

### 5.9 å‰ç«¯ â†’ åˆçº¦æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯ (é“¾ä¸‹)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. usePathFinder Hook                                          â”‚
â”‚     â”œâ”€â”€ generatePaths() ç”Ÿæˆæ‰€æœ‰å¯èƒ½è·¯å¾„                         â”‚
â”‚     â”œâ”€â”€ useReadContracts() æ‰¹é‡è°ƒç”¨ getAmountsOut               â”‚
â”‚     â””â”€â”€ sort() æŒ‰è¾“å‡ºæ’åºï¼Œè¿”å›æœ€ä¼˜è·¯å¾„                          â”‚
â”‚                                                                 â”‚
â”‚  2. MultiHopSwap ç»„ä»¶                                           â”‚
â”‚     â”œâ”€â”€ selectedPath = bestPath                                 â”‚
â”‚     â””â”€â”€ ç”¨æˆ·ç‚¹å‡» Swap æŒ‰é’®                                       â”‚
â”‚                                                                 â”‚
â”‚  3. handleSwap()                                                â”‚
â”‚     â””â”€â”€ writeContract({                                         â”‚
â”‚           functionName: 'swapExactTokensForTokens',             â”‚
â”‚           args: [amountIn, minOut, path[], to, deadline]        â”‚
â”‚         })                                                      â”‚
â”‚                              â†“ å‘é€äº¤æ˜“                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åˆçº¦ (é“¾ä¸Š)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              â†“                                  â”‚
â”‚  4. Router.swapExactTokensForTokens(path)                       â”‚
â”‚     â”œâ”€â”€ ensure(deadline) éªŒè¯æœªè¿‡æœŸ                              â”‚
â”‚     â”œâ”€â”€ getAmountsOut() è®¡ç®—æ¯è·³è¾“å‡º                             â”‚
â”‚     â”œâ”€â”€ require(output >= min) æ»‘ç‚¹ä¿æŠ¤                          â”‚
â”‚     â””â”€â”€ _swap() æ‰§è¡Œå¤šè·³                                         â”‚
â”‚                              â†“                                  â”‚
â”‚  5. _swap() å¾ªç¯æ‰§è¡Œ                                             â”‚
â”‚     â”œâ”€â”€ HOP 1: Pair(TKA/TKC).swap() â†’ è¾“å‡º TKC                  â”‚
â”‚     â””â”€â”€ HOP 2: Pair(TKC/TKB).swap() â†’ è¾“å‡º TKB åˆ°ç”¨æˆ·            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.10 æµç¨‹å›¾

- è¯¦ç»†çš„å‰åç«¯äº¤äº’æµç¨‹å›¾

![](../images/multi_hop_swap_flow.svg)

---

## 6. é…ç½®é¡¹

### 6.1 åˆçº¦é…ç½® (`src/config/contracts.ts`)

```typescript
// ä¿®æ”¹åˆçº¦åœ°å€
export const CONTRACTS = {
  FACTORY: '0x...', // Factory åˆçº¦åœ°å€
  ROUTER: '0x...',  // Router åˆçº¦åœ°å€
  WETH: '0x...',    // WETH åœ°å€
  TOKEN_A: '0x...', // ä»£å¸ A åœ°å€
  TOKEN_B: '0x...', // ä»£å¸ B åœ°å€
  PAIR: '0x...',    // äº¤æ˜“å¯¹åœ°å€
};
```

### 6.2 ç½‘ç»œé…ç½® (`src/config/wagmi.ts`)

```typescript
import { sepolia, mainnet } from 'wagmi/chains';

export const config = createConfig({
  chains: [sepolia], // æ”¯æŒçš„é“¾ï¼Œå¯æ·»åŠ  mainnet ç­‰
  connectors: [injected()],
  transports: {
    [sepolia.id]: http(), // å¯é…ç½®è‡ªå®šä¹‰ RPC
  },
});
```

**åˆ‡æ¢åˆ°ä¸»ç½‘**:
```typescript
import { mainnet } from 'wagmi/chains';

export const config = createConfig({
  chains: [mainnet],
  transports: {
    [mainnet.id]: http('https://eth-mainnet.g.alchemy.com/v2/YOUR_KEY'),
  },
});
```

---

## 7. å¿«é€Ÿå¯åŠ¨

### 7.1 ç¯å¢ƒè¦æ±‚

- Node.js >= 18.x
- npm >= 9.x
- MetaMask æµè§ˆå™¨æ’ä»¶

### 7.2 å®‰è£…ä¾èµ–

```bash
cd frontend
npm install
```

### 7.3 å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

è®¿é—® http://localhost:5173

### 7.4 æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
npm run build
```

æ„å»ºäº§ç‰©ä½äº `dist/` ç›®å½•

### 7.5 é¢„è§ˆç”Ÿäº§ç‰ˆæœ¬

```bash
npm run preview
```

---

## 8. äºŒæ¬¡å¼€å‘

### 8.1 æ·»åŠ æ–°ä»£å¸

1. åœ¨ `contracts.ts` ä¸­æ·»åŠ ä»£å¸åœ°å€:
```typescript
export const CONTRACTS = {
  // ...existing
  TOKEN_C: '0x...' as const,
};
```

2. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨æ–°ä»£å¸åœ°å€

### 8.2 æ·»åŠ æ–°åŠŸèƒ½ç»„ä»¶

1. åœ¨ `src/components/` ä¸‹åˆ›å»ºæ–°ç»„ä»¶
2. ä½¿ç”¨ Wagmi Hooks ä¸åˆçº¦äº¤äº’:

```typescript
import { useReadContract, useWriteContract } from 'wagmi';

export function MyComponent() {
  // è¯»å–åˆçº¦
  const { data } = useReadContract({
    address: CONTRACTS.ROUTER,
    abi: ROUTER_ABI,
    functionName: 'myFunction',
    args: [...],
  });

  // å†™å…¥åˆçº¦
  const { writeContract } = useWriteContract();
  
  const handleAction = () => {
    writeContract({
      address: CONTRACTS.ROUTER,
      abi: ROUTER_ABI,
      functionName: 'myFunction',
      args: [...],
    });
  };
}
```

### 8.3 è‡ªå®šä¹‰æ ·å¼

æ ·å¼æ–‡ä»¶ä½äº `src/App.css`ï¼Œé‡‡ç”¨ CSS å˜é‡å’Œæ¸å˜è‰²è®¾è®¡:

```css
/* ä¸»è‰²è°ƒ */
.btn-primary {
  background: linear-gradient(90deg, #ff6b9d, #c44569);
}

/* å¡ç‰‡æ ·å¼ */
.card {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
}
```

### 8.4 æ·»åŠ æ–°ç½‘ç»œ

åœ¨ `wagmi.ts` ä¸­æ·»åŠ :

```typescript
import { sepolia, polygon, arbitrum } from 'wagmi/chains';

export const config = createConfig({
  chains: [sepolia, polygon, arbitrum],
  transports: {
    [sepolia.id]: http(),
    [polygon.id]: http(),
    [arbitrum.id]: http(),
  },
});
```

### 8.5 å¸¸ç”¨ Wagmi Hooks

| Hook | ç”¨é€” |
|------|------|
| `useAccount()` | è·å–å½“å‰è´¦æˆ· |
| `useConnect()` | è¿æ¥é’±åŒ… |
| `useDisconnect()` | æ–­å¼€é’±åŒ… |
| `useReadContract()` | è¯»å–å•ä¸ªåˆçº¦ |
| `useReadContracts()` | æ‰¹é‡è¯»å–åˆçº¦ |
| `useWriteContract()` | å†™å…¥åˆçº¦ |
| `useWaitForTransactionReceipt()` | ç­‰å¾…äº¤æ˜“ç¡®è®¤ |
| `useBalance()` | è·å– ETH ä½™é¢ |

---

## 9. å¸¸è§é—®é¢˜

### Q1: è¿æ¥é’±åŒ…åæ˜¾ç¤ºé”™è¯¯ç½‘ç»œ

**è§£å†³**: åœ¨ MetaMask ä¸­åˆ‡æ¢åˆ° Sepolia æµ‹è¯•ç½‘

### Q2: äº¤æ˜“å¤±è´¥ "INSUFFICIENT_ALLOWANCE"

**è§£å†³**: éœ€è¦å…ˆæˆæƒä»£å¸ç»™ Router åˆçº¦

### Q3: äº¤æ˜“å¤±è´¥ "EXPIRED"

**è§£å†³**: deadline å‚æ•°è¿‡æœŸï¼Œä»£ç ä¸­å·²è®¾ç½®ä¸º 30 åˆ†é’Ÿå

### Q4: å¦‚ä½•è·å– Sepolia æµ‹è¯•å¸

- [Alchemy Faucet](https://sepoliafaucet.com/)
- [Infura Faucet](https://www.infura.io/faucet/sepolia)

### Q5: å¦‚ä½•éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

```bash
# æ„å»º
npm run build

# éƒ¨ç½² dist/ ç›®å½•åˆ°:
# - Vercel
# - Netlify
# - GitHub Pages
# - ä»»æ„é™æ€æ‰˜ç®¡æœåŠ¡
```

---

## ç›¸å…³é“¾æ¥

- [Uniswap V2 åˆçº¦æ–‡æ¡£](../DEPLOYMENT.md)
- [Wagmi æ–‡æ¡£](https://wagmi.sh/)
- [Viem æ–‡æ¡£](https://viem.sh/)
- [Sepolia Etherscan](https://sepolia.etherscan.io/)

---

## License

MIT
